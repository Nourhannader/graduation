
<div class="main-container">
  <div class="profile-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="h4 mb-0">My Profile</h2>
    </div>
    
    <div class="profile-header">
      <img
        [src]="user?.image"
        [alt]="user?.userName"
        class="profile-img me-3"
      />
      <button class="edit-btnUser" (click)="showPopup = true">
        <i class="bi bi-pencil"></i>
      </button>
      <div class="profile-info">
        <h3>{{ user?.firstName }} {{ user?.lastName }}</h3>
        <p>{{ user?.userName }}</p>
      </div>
      <!-- <button class="edit-btn">
        <i class="fas fa-edit"></i>
      </button> -->
    </div>

    <!-- Personal Information -->
    <div class="section">
      <div class="section-header">
        <h3 class="section-title">Personal Information</h3>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">First Name</label>
          <div class="form-value">{{ user?.firstName }}</div>
        </div>
        <div class="form-group">
          <label class="form-label">Last Name</label>
          <div class="form-value">{{ user?.lastName }}</div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Email address</label>
          <div class="form-value">{{ user?.email }}</div>
        </div>
        <div class="form-group">
          <label class="form-label">UserName</label>
          <div class="form-value">{{ user?.userName }}</div>
        </div>
      </div>
      @if(user?.phoneNumber != null){
      <div class="form-group">
        <label class="form-label">Phone</label>
        <div class="form-value">{{ user?.phoneNumber }}</div>
      </div>
      }
    </div>

    <!-- Address -->
    <div class="section">
      <div class="section-header">
        <h3 class="section-title">Compound Address</h3>
      </div>
      @if(user && user.compLocation && user.compLocation.length > 0){
      @for(location of user?.compLocation;track $index){
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">City</label>
          <div class="form-value">{{ location.city }}</div>
        </div>
        <div class="form-group">
          <label class="form-label">Area</label>
          <div class="form-value">{{ location.area }}</div>
        </div>
      </div>
      } }

      <div class="form-group">
          <label class="form-label">Compound Name <button (click)="openToEditComm()"  class="editCommunity"><i  class="bi bi-pencil"></i></button></label>          
          <div class="form-value">{{ currentName }}</div>
        </div>
      </div>
    
  </div>
</div>

@if(openToEdit==true)
{
  <div class="background">
    <form [formGroup]="EditNameForm" (ngSubmit)="UpdateName()">
    <div class="editDiv">
            <h4>Your Community Name</h4>
            <input formControlName="Name" [value]="currentName" type="text" placeholder="community name" class="form-control">
             @if(EditNameForm.get('Name')?.errors && EditNameForm.get('Name')?.touched)
             {
            @if(EditNameForm.get('Name')?.hasError('required')) {
            <p class="error">This field is required</p>
            }
            }
    </div>
    <div class="edit-buttons">
    <button class="submit" [disabled]="!EditNameForm.valid">Edit</button>
    <button class="cancel" (click)="closeEdit()">Cancel</button>
    </div>
</form>
  </div>
}

<!-- Custom Popup -->
 @if(showPopup){
<div class="popup-backdrop" >
  <div class="popup-card">
    <h5>Upload New Profile Image</h5>

    <input
      type="file"
      (change)="onImageSelected($event)"
      accept="image/*"
      class="form-control"
    />

    <!-- Preview -->
    <div *ngIf="previewUrl" class="mt-3 text-center">
      <img [src]="previewUrl" class="img-fluid rounded" style="max-height: 200px;" />
    </div>

    <div class="popup-actions">
      <button class="btn btn-secondary" (click)="closePopup()">Cancel</button>
      <button class="btn btn-primary" (click)="uploadImage()" [disabled]="!selectedFile">
        Upload
      </button>
    </div>
  </div>
</div>
 }