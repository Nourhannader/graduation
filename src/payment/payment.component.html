<div class="col-md-7 col-lg-8">
  <div class="checkout-form-card">
    <h4 class="mb-3">Billing address</h4>

    <ng-container *ngIf="paymentSuccess; else formBlock">
      <div class="alert alert-success success-animation">
        <h4>Payment Successful!</h4>
        <p>Your order has been placed successfully. You will be redirected to the order confirmation page.</p>
      </div>
    </ng-container>

    <ng-template #formBlock>
      <form [formGroup]="checkoutForm" (ngSubmit)="onFormSubmit()" class="needs-validation">
        <div class="row g-3">
          <div class="col-sm-6">
            <label for="firstName" class="form-label">First name</label>
            <input
              id="firstName"
              type="text"
              class="form-control input-animate"
              formControlName="firstName"
              [ngClass]="{ 'is-invalid': getFieldError('firstName') }"
              required
            />
            <div class="invalid-feedback" *ngIf="getFieldError('firstName')">
              {{ getFieldError('firstName') }}
            </div>
          </div>

          <div class="col-sm-6">
            <label for="lastName" class="form-label">Last name</label>
            <input
              id="lastName"
              type="text"
              class="form-control input-animate"
              formControlName="lastName"
              [ngClass]="{ 'is-invalid': getFieldError('lastName') }"
              required
            />
            <div class="invalid-feedback" *ngIf="getFieldError('lastName')">
              {{ getFieldError('lastName') }}
            </div>
          </div>

          <div class="col-12">
            <label for="username" class="form-label">Username</label>
            <div class="input-group has-validation">
              <span class="input-group-text"></span>
              <input
                id="username"
                type="text"
                class="form-control input-animate"
                formControlName="username"
                [ngClass]="{ 'is-invalid': getFieldError('username') }"
                required
              />
              <div class="invalid-feedback" *ngIf="getFieldError('username')">
                {{ getFieldError('username') }}
              </div>
            </div>
          </div>

          <div class="col-12">
            <label for="email" class="form-label">Email</label>
            <input
              id="email"
              type="email"
              class="form-control input-animate"
              formControlName="email"
              placeholder="you@example.com"
              [ngClass]="{ 'is-invalid': getFieldError('email') }"
              required
            />
            <div class="invalid-feedback" *ngIf="getFieldError('email')">
              {{ getFieldError('email') }}
            </div>
          </div>

          <div class="col-12">
            <label for="address" class="form-label">Address</label>
            <input
              id="address"
              type="text"
              class="form-control input-animate"
              formControlName="address"
              placeholder="1234 Main St"
              [ngClass]="{ 'is-invalid': getFieldError('address') }"
              required
            />
            <div class="invalid-feedback" *ngIf="getFieldError('address')">
              {{ getFieldError('address') }}
            </div>
          </div>

          <div class="col-12">
            <label for="address2" class="form-label">Address 2 <span class="text-body-secondary">(Optional)</span></label>
            <input
              id="address2"
              type="text"
              class="form-control input-animate"
              formControlName="address2"
              placeholder="Apartment or suite"
            />
          </div>

          <div class="col-md-5">
            <label for="country" class="form-label">Country</label>
            <select
              id="country"
              class="form-select input-animate"
              formControlName="country"
              [ngClass]="{ 'is-invalid': getFieldError('country') }"
              required
            >
              <option value="EG">Egypt</option>
              <option value="US">United States</option>
              <option value="CA">Canada</option>
            </select>
            <div class="invalid-feedback" *ngIf="getFieldError('country')">
              {{ getFieldError('country') }}
            </div>
          </div>

          <div class="col-md-4">
            <label for="state" class="form-label">State/Governorate</label>
            <select
              id="state"
              class="form-select input-animate"
              formControlName="state"
              [ngClass]="{ 'is-invalid': getFieldError('state') }"
              required
            >
              <option value="">Choose...</option>
              <option value="CAI">Cairo</option>
              <option value="ALX">Alexandria</option>
              <option value="GIZ">Giza</option>
            </select>
            <div class="invalid-feedback" *ngIf="getFieldError('state')">
              {{ getFieldError('state') }}
            </div>
          </div>

          <div class="col-md-3">
            <label for="zip" class="form-label">Postal Code</label>
            <input
              id="zip"
              type="text"
              class="form-control input-animate"
              formControlName="zip"
              [ngClass]="{ 'is-invalid': getFieldError('zip') }"
              required
            />
            <div class="invalid-feedback" *ngIf="getFieldError('zip')">
              {{ getFieldError('zip') }}
            </div>
          </div>
        </div>

        <hr class="my-4" />

        <h4 class="mb-3">Payment</h4>
        <div class="my-3">
          <div class="form-check">
            <input
              id="paypal"
              name="paymentMethod"
              type="radio"
              class="form-check-input"
              value="paypal"
              formControlName="paymentMethod"
              checked
              required
            />
            <label class="form-check-label" for="paypal">PayPal</label>
          </div>
        </div>

        <hr class="my-4" />

        <button
          class="btn btn-primary btn-lg mb-4 submit-btn"
          type="submit"
          [disabled]="checkoutForm.invalid || isLoading"
        >
          <ng-container *ngIf="!isLoading">Continue to Payment</ng-container>
          <ng-container *ngIf="isLoading">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Processing...
          </ng-container>
        </button>

        <div id="paypal-button-container" class="mt-4 w-100"></div>
      </form>
    </ng-template>
  </div>

  <p *ngIf="rentId">Ready to pay for rent ID: {{ rentId }}</p>
</div>
